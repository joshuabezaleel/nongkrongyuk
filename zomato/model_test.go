package zomato

import (
	"encoding/json"
	"testing"
)

func TestUnmarshalSearchResponse(t *testing.T) {
	jsonstr := `{"results_found":4106,"results_start":1,"results_shown":5,"restaurants":[{"restaurant":{"R":{"res_id":18407025},"apikey":"714360826776456331f2a2c30ea6930a","id":"18407025","name":"Kalpa Tree ","url":"https:\/\/www.zomato.com\/bandung\/kalpa-tree-ciumbuleuit?utm_source=api_basic_user&utm_medium=api&utm_campaign=v2.1","location":{"address":"Jl. Kiputih No. 37, Ciumbuleuit, Bandung","locality":"Ciumbuleuit","city":"Bandung","city_id":11052,"latitude":"-6.8662014000","longitude":"107.6082161000","zipcode":"","country_id":94,"locality_verbose":"Ciumbuleuit, Bandung"},"switch_to_order_menu":0,"cuisines":"Western, Indonesian","average_cost_for_two":200000,"price_range":3,"currency":"IDR","offers":[],"thumb":"","user_rating":{"aggregate_rating":"3.7","rating_text":"Good","rating_color":"9ACD32","votes":"29","custom_rating_text":"NEW","custom_rating_text_background":"#89959B","rating_tool_tip":"This restaurant has been added recently. The rating will appear once enough users have rated the restaurant."},"photos_url":"https:\/\/www.zomato.com\/bandung\/kalpa-tree-ciumbuleuit\/photos?utm_source=api_basic_user&utm_medium=api&utm_campaign=v2.1#tabtop","menu_url":"https:\/\/www.zomato.com\/bandung\/kalpa-tree-ciumbuleuit\/menu?utm_source=api_basic_user&utm_medium=api&utm_campaign=v2.1&openSwipeBox=menu&showMinimal=1#tabtop","featured_image":"","has_online_delivery":0,"is_delivering_now":0,"deeplink":"zomato:\/\/restaurant\/18407025","has_table_booking":0,"events_url":"https:\/\/www.zomato.com\/bandung\/kalpa-tree-ciumbuleuit\/events#tabtop?utm_source=api_basic_user&utm_medium=api&utm_campaign=v2.1","establishment_types":[]}},{"restaurant":{"R":{"res_id":18387855},"apikey":"714360826776456331f2a2c30ea6930a","id":"18387855","name":"Miss Bee Providore","url":"https:\/\/www.zomato.com\/bandung\/miss-bee-providore-ciumbuleuit?utm_source=api_basic_user&utm_medium=api&utm_campaign=v2.1","location":{"address":"Jl. Rancabentang No. 11A, Ciumbuleuit, Bandung","locality":"Ciumbuleuit","city":"Bandung","city_id":11052,"latitude":"-6.8683855245","longitude":"107.6093053445","zipcode":"","country_id":94,"locality_verbose":"Ciumbuleuit, Bandung"},"switch_to_order_menu":0,"cuisines":"European, Asian","average_cost_for_two":150000,"price_range":3,"currency":"IDR","offers":[],"thumb":"","user_rating":{"aggregate_rating":"4.9","rating_text":"Excellent","rating_color":"3F7E00","votes":"140"},"photos_url":"https:\/\/www.zomato.com\/bandung\/miss-bee-providore-ciumbuleuit\/photos?utm_source=api_basic_user&utm_medium=api&utm_campaign=v2.1#tabtop","menu_url":"https:\/\/www.zomato.com\/bandung\/miss-bee-providore-ciumbuleuit\/menu?utm_source=api_basic_user&utm_medium=api&utm_campaign=v2.1&openSwipeBox=menu&showMinimal=1#tabtop","featured_image":"","has_online_delivery":0,"is_delivering_now":0,"deeplink":"zomato:\/\/restaurant\/18387855","has_table_booking":0,"events_url":"https:\/\/www.zomato.com\/bandung\/miss-bee-providore-ciumbuleuit\/events#tabtop?utm_source=api_basic_user&utm_medium=api&utm_campaign=v2.1","establishment_types":[]}},{"restaurant":{"R":{"res_id":18400530},"apikey":"714360826776456331f2a2c30ea6930a","id":"18400530","name":"Noah's Barn Coffeenery","url":"https:\/\/www.zomato.com\/bandung\/noahs-barn-coffeenery-dago?utm_source=api_basic_user&utm_medium=api&utm_campaign=v2.1","location":{"address":"Jl. Dayang Sumbi No. 2, Dago, Bandung","locality":"Dago","city":"Bandung","city_id":11052,"latitude":"-6.8870575010","longitude":"107.6127895340","zipcode":"","country_id":94,"locality_verbose":"Dago, Bandung"},"switch_to_order_menu":0,"cuisines":"Cafe, Coffee and Tea, Western","average_cost_for_two":150000,"price_range":3,"currency":"IDR","offers":[],"thumb":"","user_rating":{"aggregate_rating":"4.3","rating_text":"Very Good","rating_color":"5BA829","votes":"75"},"photos_url":"https:\/\/www.zomato.com\/bandung\/noahs-barn-coffeenery-dago\/photos?utm_source=api_basic_user&utm_medium=api&utm_campaign=v2.1#tabtop","menu_url":"https:\/\/www.zomato.com\/bandung\/noahs-barn-coffeenery-dago\/menu?utm_source=api_basic_user&utm_medium=api&utm_campaign=v2.1&openSwipeBox=menu&showMinimal=1#tabtop","featured_image":"","has_online_delivery":0,"is_delivering_now":0,"deeplink":"zomato:\/\/restaurant\/18400530","has_table_booking":0,"events_url":"https:\/\/www.zomato.com\/bandung\/noahs-barn-coffeenery-dago\/events#tabtop?utm_source=api_basic_user&utm_medium=api&utm_campaign=v2.1","establishment_types":[]}},{"restaurant":{"R":{"res_id":18404865},"apikey":"714360826776456331f2a2c30ea6930a","id":"18404865","name":"Sejiwa Coffee","url":"https:\/\/www.zomato.com\/bandung\/sejiwa-coffee-riau?utm_source=api_basic_user&utm_medium=api&utm_campaign=v2.1","location":{"address":"Jl. Progo No.15, Riau, Bandung","locality":"Riau","city":"Bandung","city_id":11052,"latitude":"-6.9043030000","longitude":"107.6185410000","zipcode":"","country_id":94,"locality_verbose":"Riau, Bandung"},"switch_to_order_menu":0,"cuisines":"Cafe, Coffee and Tea, Desserts","average_cost_for_two":100000,"price_range":3,"currency":"IDR","offers":[],"thumb":"https:\/\/b.zmtcdn.com\/data\/res_imagery\/18404865_RESTAURANT_02ba76afa61822bc0485ce834be4497d.jpg?fit=around%7C200%3A200&crop=200%3A200%3B%2A%2C%2A","user_rating":{"aggregate_rating":"4.0","rating_text":"Very Good","rating_color":"5BA829","votes":"123"},"photos_url":"https:\/\/www.zomato.com\/bandung\/sejiwa-coffee-riau\/photos?utm_source=api_basic_user&utm_medium=api&utm_campaign=v2.1#tabtop","menu_url":"https:\/\/www.zomato.com\/bandung\/sejiwa-coffee-riau\/menu?utm_source=api_basic_user&utm_medium=api&utm_campaign=v2.1&openSwipeBox=menu&showMinimal=1#tabtop","featured_image":"https:\/\/b.zmtcdn.com\/data\/res_imagery\/18404865_RESTAURANT_02ba76afa61822bc0485ce834be4497d.jpg","has_online_delivery":0,"is_delivering_now":0,"deeplink":"zomato:\/\/restaurant\/18404865","has_table_booking":0,"events_url":"https:\/\/www.zomato.com\/bandung\/sejiwa-coffee-riau\/events#tabtop?utm_source=api_basic_user&utm_medium=api&utm_campaign=v2.1","establishment_types":[]}},{"restaurant":{"R":{"res_id":18051542},"apikey":"714360826776456331f2a2c30ea6930a","id":"18051542","name":"Lawang Wangi","url":"https:\/\/www.zomato.com\/bandung\/lawang-wangi-dago-pakar?utm_source=api_basic_user&utm_medium=api&utm_campaign=v2.1","location":{"address":"Jl. Dago Giri No. 99A, Dago Pakar, Bandung","locality":"Dago Pakar","city":"Bandung","city_id":11052,"latitude":"-6.8475986701","longitude":"107.6277029514","zipcode":"","country_id":94,"locality_verbose":"Dago Pakar, Bandung"},"switch_to_order_menu":0,"cuisines":"Cafe, Indonesian, Western","average_cost_for_two":200000,"price_range":3,"currency":"IDR","offers":[],"thumb":"https:\/\/b.zmtcdn.com\/data\/res_imagery\/18051542_RESTAURANT_d3f140df8573473534d3b75cf826218e.jpg?fit=around%7C200%3A200&crop=200%3A200%3B%2A%2C%2A","user_rating":{"aggregate_rating":"4.1","rating_text":"Very Good","rating_color":"5BA829","votes":"88"},"photos_url":"https:\/\/www.zomato.com\/bandung\/lawang-wangi-dago-pakar\/photos?utm_source=api_basic_user&utm_medium=api&utm_campaign=v2.1#tabtop","menu_url":"https:\/\/www.zomato.com\/bandung\/lawang-wangi-dago-pakar\/menu?utm_source=api_basic_user&utm_medium=api&utm_campaign=v2.1&openSwipeBox=menu&showMinimal=1#tabtop","featured_image":"https:\/\/b.zmtcdn.com\/data\/res_imagery\/18051542_RESTAURANT_d3f140df8573473534d3b75cf826218e.jpg","has_online_delivery":0,"is_delivering_now":0,"deeplink":"zomato:\/\/restaurant\/18051542","has_table_booking":0,"events_url":"https:\/\/www.zomato.com\/bandung\/lawang-wangi-dago-pakar\/events#tabtop?utm_source=api_basic_user&utm_medium=api&utm_campaign=v2.1","establishment_types":[]}}]}`
	var response SearchByLatLongResponse
	err := json.Unmarshal([]byte(jsonstr), &response)
	if err != nil {
		t.Fatalf("Error unmarshal: %s", err.Error())
	}
	if response.Restaurants[0].Name != "Kalpa Tree " {
		t.Fatalf("Unexpected name, expected %s, got %s", "Kalpa Tree ", response.Restaurants[0].Name)
	}
}
